<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Mes Courses ‚Äî DIGIY DRIVER PRO</title>
  <meta name="theme-color" content="#061b14"/>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root{--bg:#061b14;--card:#0b2a1f;--line:rgba(255,255,255,.14);--text:#eafff1;--muted:rgba(234,255,241,.78);--green:#16a34a;--gold:#facc15;--r:18px}
    *{box-sizing:border-box}
    body{margin:0;min-height:100vh;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:radial-gradient(900px 500px at 10% -10%,rgba(34,197,94,.20),transparent 60%),radial-gradient(900px 500px at 110% 0%,rgba(250,204,21,.14),transparent 55%),var(--bg);color:var(--text)}
    header{position:sticky;top:0;z-index:10;backdrop-filter:blur(10px);background:rgba(6,27,20,.75);border-bottom:1px solid var(--line);padding:14px 16px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .title{font-weight:900;letter-spacing:.2px;font-size:18px}
    .pill{padding:8px 10px;border:1px solid var(--line);border-radius:999px;font-size:13px;color:var(--muted);background:rgba(0,0,0,.22);display:inline-flex;gap:8px;align-items:center;white-space:nowrap}
    a.pill{text-decoration:none}
    main{padding:16px;max-width:980px;margin:0 auto}
    .grid{display:grid;gap:12px;grid-template-columns:repeat(12,1fr)}
    .card{grid-column:span 12;background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03));border:1px solid var(--line);border-radius:var(--r);padding:16px;box-shadow:0 12px 40px rgba(0,0,0,.32)}
    @media(min-width:860px){.card.half{grid-column:span 6}}
    h1{margin:0 0 8px;font-size:20px}
    p{margin:0;color:var(--muted);line-height:1.45}
    button{border:0;cursor:pointer;padding:12px 14px;border-radius:14px;font-weight:900;font-size:15px}
    .btn{background:linear-gradient(135deg,rgba(34,197,94,.95),rgba(16,185,129,.85));color:#042012}
    .btn2{background:rgba(250,204,21,.14);color:var(--text);border:1px solid rgba(250,204,21,.25)}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .muted{color:var(--muted);font-size:13px}
    .list{margin-top:10px;display:grid;gap:10px}
    .item{border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:12px;background:rgba(0,0,0,.18);display:flex;justify-content:space-between;gap:12px;align-items:flex-start;transition:all .2s}
    .item:hover{border-color:rgba(34,197,94,.5);background:rgba(34,197,94,.08);transform:translateY(-2px)}
    .tag{font-size:12px;padding:6px 10px;border-radius:999px;white-space:nowrap;font-weight:900}
    .tag.new{border:1px solid rgba(34,197,94,.35);background:rgba(34,197,94,.12);color:rgba(234,255,241,.92)}
    .tag.soon{border:1px solid rgba(250,204,21,.35);background:rgba(250,204,21,.12);color:rgba(254,243,199,.92)}
    .tag.planned{border:1px solid rgba(59,130,246,.35);background:rgba(59,130,246,.12);color:rgba(191,219,254,.92)}
  </style>
</head>
<body>
<header>
  <div class="title">üöó Mes Courses</div>

  <!-- ‚úÖ NAV LIBERT√â (pas de prison) -->
  <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end">
    <a class="pill" href="./index.html">üè† Dashboard</a>
    <a class="pill" href="./driver-zone-kiff.html">üìç Secteurs</a>
    <a class="pill" href="./mes-lieux-kiff.html">üìå Mes lieux</a>
    <div class="pill" id="pillPhone">üì± ‚Ä¶</div>
  </div>
</header>

<main>
  <div class="grid">
    <section class="card half">
      <h1>T'es en ligne fr√©rot ! ü¶Ö</h1>
      <p id="status">Chargement‚Ä¶</p>
      <div class="row">
        <button class="btn" id="btnRefresh">üîÑ Actualiser</button>
        <button class="btn2" id="btnLogout">üö™ Me d√©connecter</button>
      </div>
      <p class="muted" style="margin-top:10px">Tu restes connect√© pendant 8h - GO GO GO !</p>
    </section>

    <section class="card half">
      <h1>Tes courses üî•</h1>
      <p class="muted">Bient√¥t tes vraies courses en direct ! Pour l'instant on te montre un aper√ßu.</p>
      <div class="list" id="list"></div>
    </section>

    <section class="card">
      <h1>Comment √ßa marche</h1>
      <p>‚úÖ T'es connect√© = tu vois tout<br>‚úÖ 8 heures de session apr√®s ta connexion<br>‚úÖ D√©connexion auto si t'es inactif trop longtemps<br>üí∞ 0% commission - Tout pour toi fr√©rot !</p>
    </section>
  </div>
</main>

<script>
(function(){
  const SESSION_KEY="DIGIY_DRIVER_PRO_SESSION",SESSION_TTL_MS=288e5;
  function now(){return Date.now()}
  function getSession(){try{const raw=localStorage.getItem(SESSION_KEY),s=JSON.parse(raw);if(!s||!s.expires_at||now()>s.expires_at)return null;return s}catch{return null}}
  function clearSession(){localStorage.removeItem(SESSION_KEY)}
  function logout(redirect="./pin.html"){clearSession();const url=new URL(location.href),slug=url.searchParams.get("slug");slug?location.replace(redirect+"?slug="+encodeURIComponent(slug)):location.replace(redirect)}
  window.DIGIY_GUARD={getSession,clearSession,logout}
})();
</script>

<script>
const pillPhone=document.getElementById("pillPhone"),statusEl=document.getElementById("status"),listEl=document.getElementById("list");
function setStatus(msg){statusEl.textContent=msg||""}
function renderRows(rows){
  listEl.innerHTML=(rows||[]).map(r=>`<div class="item"><div><div style="font-weight:900">${r.id} ‚Äî ${r.zone}</div><div class="muted">${r.when}</div></div><div class="tag ${r.status}">${r.label}</div></div>`).join("");
}
function demoRows(){
  renderRows([
    {id:"C-1001",zone:"Saly Centre",when:"Maintenant",status:"new",label:"üî• Nouvelle !"},
    {id:"C-1002",zone:"Ngaparou",when:"Dans 30 min",status:"soon",label:"‚è∞ Bient√¥t"},
    {id:"C-1003",zone:"Dakar Plateau",when:"Demain",status:"planned",label:"üìÖ Programm√©e"}
  ]);
}
async function boot(){
  const session=window.DIGIY_GUARD.getSession();
  if(!session||!session.owner_id){
    const url=new URL(location.href),slug=url.searchParams.get("slug");
    location.replace(slug?`./pin.html?slug=${encodeURIComponent(slug)}`:"./pin.html");
    return;
  }
  pillPhone.textContent="üì± "+(session.phone||session.slug||"Connect√©");
  setStatus(`‚úÖ Connect√© ${session.title||"fr√©rot"} ü¶Ö`);
  demoRows();
}
document.getElementById("btnRefresh").addEventListener("click",()=>boot());
document.getElementById("btnLogout").addEventListener("click",()=>{confirm("Tu veux vraiment te d√©connecter fr√©rot ?")&&window.DIGIY_GUARD.logout()});
boot();
</script>
</body>
</html>
